<!doctype html>
<html lang="tr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Redstar CBT ✅</title>

  <meta name="theme-color" content="#cc0000" />
  <link rel="manifest" href="manifest.webmanifest?v=rs7" />
  <link rel="apple-touch-icon" href="assets/icons/icon-192.png" />
  <link rel="icon" type="image/png" href="assets/icons/icon-192.png" />

  <link rel="preload" as="image" href="assets/brand/redstar-aviation.png" />
  <link rel="stylesheet" href="styles/main.css?v=rs7" />
  <style>.body--lock { overflow: hidden; }</style>
</head>
<body>
  <header class="appbar">
    <a class="brand" href="./" aria-label="Redstar Aviation CBT">
      <img src="assets/brand/redstar-aviation.png" alt="Redstar Aviation"
           width="220" height="44" decoding="async" fetchpriority="high"/>
      <span class="sr-only">CBT</span>
    </a>
    <button id="installBtn" class="btn" hidden>Uygulamayı Kur</button>
  </header>

  <main id="app">
    <!-- HERO -->
    <section id="hero" style="background-image:url('assets/bg-clouds.jpg');background-size:cover;background-position:center;">
      <div class="hero-wrap">
        <button class="plane-card" id="plane-learjet" title="Learjet 45 XR">
          <img src="assets/learjet.png" alt="Learjet 45 XR">
          <span class="plane-label">Learjet 45 XR</span>
        </button>
      </div>
    </section>

    <!-- MODULE SEÇİMİ -->
    <section id="training" hidden aria-labelledby="trainingTitle">
      <div class="section-wrap">
        <h2 id="trainingTitle">Learjet 45 İnitial Training</h2>
        <p id="trainingSelection" class="training-selection"></p>
        <div class="training-grid">
          <button class="training-card" data-id="egitim1">
            <div class="training-card-body">
              <h3>Module 1</h3>
              <p>Bekir abi belirleyecek</p>
            </div>
          </button>
          <button class="training-card" data-id="egitim2">
            <div class="training-card-body">
              <h3>Module 2</h3>
              <p>Bekir abi belirleyecek</p>
            </div>
          </button>
        </div>
      </div>
    </section>

    <!-- TOPIC SEÇİMİ -->
    <section id="topics" hidden aria-labelledby="topicsTitle">
      <div class="section-wrap">
        <h2 id="topicsTitle">Topics</h2>

        <div id="topics-egitim1" hidden>
          <div class="training-grid">
            <button class="training-card topic-card" data-topic-id="e1-01">
              <div class="training-card-body"><h3>Airplane General</h3></div>
            </button>
            <button class="training-card topic-card" data-topic-id="e1-02">
              <div class="training-card-body"><h3>Hydraulic</h3></div>
            </button>
            <button class="training-card topic-card" data-topic-id="e1-03">
              <div class="training-card-body"><h3>Electrical</h3></div>
            </button>
            <button class="training-card topic-card" data-topic-id="e1-04">
              <div class="training-card-body"><h3>Lighting</h3></div>
            </button>
            <button class="training-card topic-card" data-topic-id="e1-05">
              <div class="training-card-body"><h3>Avionics 1</h3></div>
            </button>
            <button class="training-card topic-card" data-topic-id="e1-06">
              <div class="training-card-body"><h3>Avionics 2</h3></div>
            </button>
            <button class="training-card topic-card" data-topic-id="e1-07">
              <div class="training-card-body"><h3>Avionics 3</h3></div>
            </button>
            <button class="training-card topic-card" data-topic-id="e1-08">
              <div class="training-card-body"><h3>A/P F/D Systems</h3></div>
            </button>
            <button class="training-card topic-card" data-topic-id="e1-09">
              <div class="training-card-body"><h3>Radio NOV &amp; COM</h3></div>
            </button>
            <button class="training-card topic-card" data-topic-id="e1-10">
              <div class="training-card-body"><h3>Flight Management</h3></div>
            </button>
          </div>
        </div>

        <div id="topics-egitim2" hidden>
          <div class="training-grid">
            <button class="training-card topic-card" data-topic-id="e2-01">
              <div class="training-card-body"><h3>Pneumatics</h3></div>
            </button>
            <button class="training-card topic-card" data-topic-id="e2-02">
              <div class="training-card-body"><h3>Airconditioning</h3></div>
            </button>
            <button class="training-card topic-card" data-topic-id="e2-03">
              <div class="training-card-body"><h3>Pressurisation</h3></div>
            </button>
            <button class="training-card topic-card" data-topic-id="e2-04">
              <div class="training-card-body"><h3>Ice & Rain Protection</h3></div>
            </button>
            <button class="training-card topic-card" data-topic-id="e2-05">
              <div class="training-card-body"><h3>Oxygen</h3></div>
            </button>
            <button class="training-card topic-card" data-topic-id="e2-06">
              <div class="training-card-body"><h3>Gear Warning/Caution</h3></div>
            </button>
            <button class="training-card topic-card" data-topic-id="e2-07">
              <div class="training-card-body"><h3>Flight Controls</h3></div>
            </button>
            <button class="training-card topic-card" data-topic-id="e2-08">
              <div class="training-card-body"><h3>Power System</h3></div>
            </button>
            <button class="training-card topic-card" data-topic-id="e2-09">
              <div class="training-card-body"><h3>Fire Protection</h3></div>
            </button>
            <button class="training-card topic-card" data-topic-id="e2-10">
              <div class="training-card-body"><h3>Fuel</h3></div>
            </button>
            <button class="training-card topic-card" data-topic-id="e2-11">
              <div class="training-card-body"><h3>Power Plant</h3></div>
            </button>
            <button class="training-card topic-card" data-topic-id="e2-12">
              <div class="training-card-body"><h3>SEP</h3></div>
            </button>
            <button class="training-card topic-card" data-topic-id="e2-13">
              <div class="training-card-body"><h3>Ground Handling</h3></div>
            </button>
            <button class="training-card topic-card" data-topic-id="e2-14">
              <div class="training-card-body"><h3>Performance</h3></div>
            </button>
          </div>
        </div>
      </div>
    </section>

    <!-- PLAYER (JSON tabanlı dersler için) -->
    <section id="player" hidden aria-live="polite">
      <nav class="player-nav">
        <button class="btn" id="backHome">← Geri</button>
        <h3 id="moduleTitle"></h3>
        <span id="progress"></span>
      </nav>
      <article id="lesson"></article>
      <section id="quiz" hidden></section>
    </section>
  </main>

  <!-- === SlidePlayer Modal === -->
  <div id="sp-modal" style="position:fixed;inset:0;background:rgba(0,0,0,.75);display:none;z-index:9999;">
    <div id="sp-sheet" style="position:absolute;inset:24px;background:#000;border-radius:12px;overflow:hidden;">
      <button onclick="closeSP()" style="position:absolute;top:10px;right:10px;padding:8px 12px;border-radius:8px;">Kapat</button>
      <iframe id="sp-frame" src="learjet-slideplayer-demo/slide-player.html" allow="autoplay"
              style="width:100%;height:100%;border:0;background:#000"></iframe>
      <div id="sp-kick" style="position:absolute;inset:0;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,.6);">
        <button onclick="kickSP()" style="padding:12px 18px;border-radius:10px;">Başlat (Ses İzni Ver)</button>
      </div>
    </div>
  </div>
  <!-- === /SlidePlayer Modal === -->

  <!-- Ana app -->
  <script type="module" src="scripts/app.js?v=rs7"></script>

  <!-- Sadece modal kontrolü: openSP / closeSP / kickSP -->
  <script>
    (() => {
      const modal = document.getElementById('sp-modal');
      const frame = document.getElementById('sp-frame');
      const kick  = document.getElementById('sp-kick');

      function openSP() {
        if (!modal) return;
        if (modal.style.display === 'block') return;
        modal.style.display = 'block';
        document.body.classList.add('body--lock');
        try { frame.contentWindow?.postMessage({ type: 'parentReady' }, '*'); } catch(e){}
      }
      function closeSP() {
        if (!modal) return;
        modal.style.display = 'none';
        document.body.classList.remove('body--lock');
        try { frame.contentWindow?.postMessage({ type: 'pauseAllAudio' }, '*'); } catch(e){}
      }
      function kickSP() {
        if (!kick) return;
        kick.style.display = 'none';
        try { frame.contentWindow?.postMessage({ type: 'kickstart' }, '*'); } catch(e){}
      }

      window.openSP  = openSP;
      window.closeSP = closeSP;
      window.kickSP  = kickSP;

      // ESC ile kapatma + dışarı tıklayınca kapatma
      document.addEventListener('keydown', (ev) => {
        if (ev.key === 'Escape' && modal && modal.style.display === 'block') closeSP();
      });
      if (modal) {
        modal.addEventListener('click', (ev) => {
          if (ev.target === modal) closeSP();
        });
      }

      // sayfa kapanırken / görünmezken audio durdur
      window.addEventListener('pagehide', () => {
        try { frame.contentWindow?.postMessage({ type: 'pauseAllAudio' }, '*'); } catch(e){}
      });
      document.addEventListener('visibilitychange', () => {
        if (document.visibilityState !== 'visible') {
          try { frame.contentWindow?.postMessage({ type: 'pauseAllAudio' }, '*'); } catch(e){}
        }
      });

      // Child'tan mesaj gelirse kapat
      window.addEventListener('message', (e) => {
        if ((e.data || {}).type === 'closeFromChild') closeSP();
      }, false);
    })();
  </script>
</body>
</html>
